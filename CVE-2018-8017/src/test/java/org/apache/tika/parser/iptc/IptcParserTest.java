package org.apache.tika.parser.iptc;

import org.junit.jupiter.api.Test;

import org.apache.tika.metadata.Metadata;
import org.apache.tika.parser.ParseContext;
import org.apache.tika.parser.Parser;
import org.opentest4j.AssertionFailedError;
import org.xml.sax.helpers.DefaultHandler;

import java.io.InputStream;
import java.time.Duration;

import static org.junit.jupiter.api.Assertions.assertThrows;
import static org.junit.jupiter.api.Assertions.assertTimeoutPreemptively;

public class IptcParserTest {

    private final Parser parser = new IptcAnpaParser();

    @Test
    public void vulnerabilityProof() {
         assertThrows(AssertionFailedError.class, this::testCVE_2018_8017);
    }

    public void testCVE_2018_8017() throws Exception {
        Metadata metadata = new Metadata();
        InputStream stream = getClass().getResourceAsStream("/test-documents/12_hang_tika_iptc.iptc");
        assertTimeoutPreemptively(Duration.ofSeconds(5), () -> parser.parse(stream, new DefaultHandler(), metadata, new ParseContext()));
    }
}
