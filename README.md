# xshady

This repo contains some projects that demonstrate the precense of vulnerabilities in libraries that use shading. The focus is on libraries not using the [shade plugin](https://maven.apache.org/plugins/maven-shade-plugin/) or similar tools, i.e. project that do not have meta data that allow dependency scanners to detect those vulnerabilities. Results are discovered with a toolchain we are building, aiming at discovering blindspots in existing SCA tools. 

## Repository Structure

The top level folders have names corresponding to the (slightly modified to make it a valid file name) [Maven coordinates (GAVs)](https://help.sonatype.com/repomanager3/using-nexus-repository/repository-manager-concepts/an-example---maven-repository-format) of vulnerable components that are being shaded. 

This subfolders then have a subfolder named `original` containing a maven project with a dependency to the vulnerable component, and tests illustrating  vulnerabilities. Dependeabot and similar tools will detect those vulnerabilities as expected through the vulnerable dependencies. Not all vulnerabilities have such tests, as the setups verifing the vulnerabilities cannot always be acquired or confirmed. 

Other subfolders contain projects where the vulnerable library is shaded (or sometimes just copied, i.e. without renaming packages), plus the tests to illustrate the respective vulnerability (the same tests as used in `original`). The interesting part is that existing security scanners do not pick this up. 



## Running Software Composition Security Analyses

The projects can be used to test various SCA tools as follows: 

### Dependabot 

The analysis is run on GitHub, check the dependabopt [result page](https://github.com/jensdietrich/xshady/security/dependabot) for the projects detected as being vulnerable.


### OWASP Dependency Check

To run the check locally via the CLI, follow [instructions](https://jeremylong.github.io/DependencyCheck/dependency-check-cli/index.html) to install the tool, the run the following command from a terminal after CDiing into the project folder:

`dependency-check -scan . -f CSV` (some other output formats are supported as well)

Scan results are committed to the repo, the reports are generated by running

`dependency-check -scan . -f JSON -o scan-results/dependency-check -prettyPrint`

and are available in `<project>/scan-results/dependency-check/`.


### Snyk

Follow the [instructions](https://docs.snyk.io/snyk-cli) to install snyk, then run `snyk auth` before using it for the first time. 

After succesful authentication, run `snyk test` in each project folder. 

Scan results are committed to the repo, the reports are generated by running

`snyk test --json --json-file-output=scan-results/snyk/snyk-report.json`

 and are available in `<project>/scan-results/snyk/`.
  
### IntelliJ IDEA 2022.2 (Ultimate Edition) / CheckMarx

IntelliJ has built-in support to detect vulnerable dependencies. To run this analysis requires to load the respective projects into the IDE. Then click on the project's `pom.xml`, and run `Analyze > Show Vulnerable Dependencies`. This will display a view with vulnerable dependencies. 

This functionality is based on [checkmarx](https://checkmarx.com/).   

## A Note on Reproducibility 

The security tools use an evolving database, so generally, re-running a scan may return more vulnerabilties than reported. We aim to commit results immediately after running scans, so that the commit timestamps can be used as provenance for the results reported.


 

 

